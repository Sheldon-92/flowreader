# 技术方案：RAG 优化与评测计划（T1-RAG-OPT）

## 目标
- 提升检索/重排质量，降低无关上下文；
- 保持响应成本与延迟在可接受范围；
- 固化一套可重复的回归评测流程。

## 现状假设
- 已有分块、向量化与基本 Top-K 检索；
- SSE 聊天使用检索上下文拼接到提示中。

## 优化方向
- 分块：按章节/段落边界优先，句内长度约 300–500 字符；
- 检索：Top-K=4–6；增加 BM25/稠密混合检索；
- 重排：轻量重排（cross-encoder）或基于相似度+位置加权；
- 拼接：基于去重与引用去噪，保留来源标注；
- 引用：为回答附带来源片段位置，便于人工核验。

## 评测方法
- 样本集：每本书 5–10 个问答样本（含消歧/概念/细节）。
- 指标：
  - 检索命中率（是否包含黄金片段）；
  - 回答相关性（3 级：低/中/高，人工标注或启发式评分）；
  - 词元成本与延迟（日志统计 p50/p95）。
- 工具：`api/_spikes/rag-quality-test.ts` 输出基线与优化后对比。

## 验收（Evidence）
- 提交优化说明与参数；
- 样本集回归结果（表格/日志）；
- 保持构建与核心端点脚本通过。

