# Story 1.2: Public Domain Library

## Status
âœ… **Approved** - Ready for Development

## Story

**As a** reader who wants to discover new books,  
**I want** to search and add public domain classics directly from within FlowReader,  
**so that** I can quickly expand my library with quality literature without having to find and upload files myself.

## Acceptance Criteria

1. **Discovery Interface**
   - User can access "Discover Books" section from main library page
   - Clear navigation between "My Library" and "Discover" sections
   - Search functionality allows searching by book title and author name
   - Browse functionality shows curated collections (e.g., "Classic Literature", "Popular Authors")

2. **Search & Browse Experience**
   - Search performance optimized with caching (15-60 min TTL for popular queries)
   - Graceful degradation when external APIs are slow or unavailable
   - Results display book title, author, publication year, and brief description
   - Search handles partial matches and common misspellings gracefully
   - Browse categories show 20-30 books per category with pagination

3. **Book Information Display**
   - Each book shows title, author, publication year, estimated reading time
   - Book preview shows first paragraph or chapter excerpt
   - Clear indication that books are public domain and free to add
   - "Add to Library" button is prominently displayed for each book

4. **Library Integration**
   - One-click "Add to Library" functionality adds book to user's personal collection
   - Added books appear immediately in user's main library
   - System prevents duplicate additions (shows "Already in Library" for owned books)
   - Addition process shows progress with estimated time based on book size
   - Duplicate detection prevents re-adding using canonical book IDs (e.g., Gutenberg ID)

5. **Content Management**
   - Public domain books are pre-processed and ready for immediate reading
   - Books maintain consistent formatting and quality standards
   - Cover images are provided for all books (generated or sourced)
   - Books integrate seamlessly with all FlowReader features (TTS, AI, notes)

6. **Performance & Reliability**
   - Discovery interface loads quickly (<3 seconds)
   - Search results are cached for common queries
   - Robust handling of network issues during book addition
   - Graceful fallback when book sources are temporarily unavailable

## Tasks / Subtasks

- [ ] **Public Domain Content Integration** (AC: 1, 2)
  - [ ] Research and integrate with Project Gutenberg API or similar
  - [ ] Create content ingestion pipeline for public domain books
  - [ ] Build search index for title/author queries
  - [ ] Implement content caching strategy

- [ ] **Discovery Interface** (AC: 1, 3)
  - [ ] Create BookDiscovery page component
  - [ ] Build search interface with real-time results
  - [ ] Design book information display cards
  - [ ] Implement browse categories with pagination
  - [ ] Add book preview functionality

- [ ] **Search Implementation** (AC: 2)
  - [ ] Implement fuzzy search for title/author matching
  - [ ] Add search result ranking and relevance scoring
  - [ ] Create search caching layer for performance
  - [ ] Handle edge cases (no results, API failures)

- [ ] **Library Integration** (AC: 4, 5)
  - [ ] Create "Add to Library" functionality
  - [ ] Implement duplicate detection logic
  - [ ] Build book download and processing workflow
  - [ ] Update library grid with real-time additions
  - [ ] Ensure added books work with existing features

- [ ] **Content Quality & Performance** (AC: 5, 6)
  - [ ] Establish book formatting standards
  - [ ] Create or source cover images for all books
  - [ ] Implement content quality validation
  - [ ] Build performance monitoring for discovery features
  - [ ] Add error handling and retry mechanisms

## Dev Notes

### Architecture Context
- Public domain books integrate with same database schema as uploaded books
- Uses separate content source (Project Gutenberg, Internet Archive, or curated collection)
- Leverages existing library display and reading infrastructure
- Maintains same security model (user-specific library access)

### Key Technical Specifications
- **Content Source**: Project Gutenberg API or pre-curated public domain collection
- **Search Implementation**: Client-side fuzzy search or lightweight search service
- **Caching Strategy**: Redis/Upstash for search results and book metadata
- **Storage**: Public domain books stored in shared Supabase Storage bucket with user references

### Integration Points
- Reuses BookCard component for consistent display
- Integrates with existing library grid and navigation
- Uses same book reading interface and feature set
- Connects with search functionality and result display

### Technical Considerations
- Public domain status verification for legal compliance
- Book format standardization (EPUB preferred)
- Content quality standards (formatting, completeness)
- Search performance optimization for large catalogs

### Data Sources Options
1. **Project Gutenberg**: 70,000+ free ebooks, reliable API (primary choice)
2. **Internet Archive**: Broader selection, more complex API (secondary)
3. **Pre-curated Collection**: Smaller but higher quality, faster performance (fallback)

### Legal & Content Standards
- Public domain status verification with source attribution
- Consistent EPUB formatting with quality validation
- Copyright notices and source attribution displayed
- Content normalization pipeline for consistent reading experience

### Testing

**Test Coverage Requirements**:
- Unit tests for search functionality and result processing
- Integration tests for book addition workflow
- E2E tests for complete discovery-to-reading flow
- Performance tests for search response times

**Testing Standards**:
- Frontend tests: Component testing for BookDiscovery and search UI
- API integration tests: Mock external API responses for reliability
- E2E tests: Full user journey from search to reading
- Performance tests: Search response time validation

**Specific Test Cases**:
- Search with exact title match
- Search with partial/fuzzy matching
- Browse category navigation and pagination
- Add book to library (new book)
- Attempt to add duplicate book
- Network failure during book addition
- Large search result set handling

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-08 | 1.0 | Initial story creation with AC and implementation tasks | Sarah (PO) |

## Dev Agent Record

*This section will be populated during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results

*This section will be populated after QA review*